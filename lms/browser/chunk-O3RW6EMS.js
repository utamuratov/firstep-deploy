import"./chunk-ZMEJBOB4.js";import{a as Ie}from"./chunk-A7WSSFSD.js";import{a as I}from"./chunk-RVZNIDLZ.js";import{a as Ae}from"./chunk-NYRIM3NQ.js";import{a as se}from"./chunk-X5MQVGBP.js";import{a as Y,b as Be}from"./chunk-AIYLSF6A.js";import{a as je}from"./chunk-XWZ3HLK5.js";import"./chunk-G6JUXHBF.js";import{b as Ve}from"./chunk-UY2FQ6MC.js";import{a as Pe,b as Re}from"./chunk-LXPRSSBN.js";import{a as Qe}from"./chunk-PWS5FQLC.js";import{a as ke,d as X}from"./chunk-MIRYO6HP.js";import{h as Ne,j as K,k as L}from"./chunk-O2BGHH3Y.js";import"./chunk-EBH5WAC4.js";import{a as Ee,b as qe}from"./chunk-2WU6MFP7.js";import"./chunk-OBQI4AT4.js";import"./chunk-AAYNF2LC.js";import"./chunk-O2RJDLPA.js";import"./chunk-E5I4EK5F.js";import"./chunk-LHBSFRJO.js";import"./chunk-WMQMVF6V.js";import{a as J}from"./chunk-R72LOZJZ.js";import{e as Me,h as De}from"./chunk-OLD4CQRK.js";import{a as Te,b as $,c as v,f as E,g as y,h as H,i as g,j as _e,k as T,l as W,n as C,q as z,r as Se,s as ie,u as U,v as x,z as q}from"./chunk-GWOLZENT.js";import"./chunk-UM7JX4F5.js";import{W as we}from"./chunk-ZKNP4OTC.js";import{$b as Ce,A as pe,Cb as A,Db as j,Eb as i,Fb as r,Gb as l,Kb as k,Nb as f,Ob as _,R as me,S as le,U as ue,Wb as p,X as de,Xb as P,Y as ce,Ya as s,ac as xe,bb as V,bc as Ge,ca as d,cc as D,hb as c,ja as S,ka as w,lb as F,na as b,nb as he,q as B,qa as fe,tc as be,ub as a,va as ve,vb as h,wa as M,ya as ge,yc as Fe,zb as ye,zc as O}from"./chunk-63MFA3PC.js";import{a as ae}from"./chunk-RJNTS35V.js";var Z=class n extends I{static \u0275fac=(()=>{let e;return function(t){return(e||(e=b(n)))(t||n)}})();static \u0275cmp=c({type:n,selectors:[["test-header"]],features:[F],decls:3,vars:3,consts:[[1,"header",3,"formGroup"],[1,"controls"],["groupName","name","flexDirection","row"]],template:function(o,t){o&1&&(i(0,"form",0)(1,"div",1),l(2,"name-translates",2),r()()),o&2&&(a("formGroup",t.formGroup),s(),h("flex-direction","row"))},dependencies:[x,T,y,C,Ve],encapsulation:2})};var ee=(o=>(o[o.Vertical=1]="Vertical",o[o.Horizontal=2]="Horizontal",o))(ee||{});var G=class n{formGroup=new H({id:new g(null),name:Ae(),reservedTime:new g(null,[v.required]),categoryId:new g(null,[v.required]),price:new g(null,[v.required]),layout:new g(2,[v.required]),isRandomly:new g(!1,[v.required]),details:new ie([this.newQuestionDetail()])});patchValue(e){this.formGroup.controls.details.clear(),this.formGroup.patchValue(ae({},e)),e.questionGroups.forEach(o=>{this.formGroup.controls.details.push(this.newQuestionDetail(o))})}newQuestionDetail(e={}){return new H({questionGroupId:new g(e.questionGroupId),details:new ie((e.details||[]).map(o=>this.newDetail(o)))})}newDetail(e={}){return new H({questionType:new g(e.questionType,[v.required]),count:new g(e.count,[v.max(e.maxCount||100),v.required]),maxCount:new g(e.maxCount,[v.required]),score:new g(e.score||1,[v.min(1),v.required])})}static \u0275fac=function(o){return new(o||n)};static \u0275prov=ce({token:n,factory:n.\u0275fac})};var He=(n,e)=>e.controls.questionType.value;function We(n,e){if(n&1){let o=k();i(0,"form",9)(1,"div",2)(2,"div",10)(3,"label"),p(4),r(),i(5,"label"),p(6),r()(),l(7,"input",11),r(),i(8,"div",2)(9,"label"),p(10,"Ball"),r(),i(11,"p-inputgroup")(12,"p-inputgroup-addon")(13,"p-button",12),f("onClick",function(){let m=S(o).$index,u=_();return w(u.changeScore("plus",m))}),r()(),l(14,"input",13),i(15,"p-inputgroup-addon")(16,"p-button",14),f("onClick",function(){let m=S(o).$index,u=_();return w(u.changeScore("minus",m))}),r()()()()()}if(n&2){let o=e.$implicit,t=_();h("flex-direction","row"),a("formGroup",o),s(4),P(t.questionTypes[o.controls.questionType.value-1].key),s(2),P(o.controls.maxCount.value),s(),h("width",230,"px"),a("max",o.controls.maxCount.value),s(7),h("width",100,"px")}}function ze(n,e){if(n&1){let o=k();i(0,"p-button",15),f("onClick",function(){S(o);let m=_();return w(m.removeGroup())}),r()}}var te=class n{constructor(e,o){this.destroyRef=e;this.cdr=o;O(()=>{this.listenQuestionGroup()})}questionGroupService=d(Be);testFormService=d(G);testGroup=M.required();index=M.required();onRemoveGroup=ve();group=ge(null);languages=Fe(()=>this.group()?.languages.map(e=>e.name).join(", "));questionTypes=Y(Qe);loadDetails(e){let o=this.removeAndGetDetails(e.countInfos);for(let t of e.countInfos)o.find(u=>u.controls.questionType.value===t.questionType)?this.testGroup().controls.details.at(0).controls.maxCount.setValue(t.count):this.testGroup().controls.details.push(this.testFormService.newDetail({questionType:t.questionType,maxCount:t.count}))}removeAndGetDetails(e){let o=this.testGroup()?.controls?.details?.controls;for(let t=o.length-1;t>=0;t--){let m=o[t].controls.questionType.value;e.find($e=>$e.questionType===m)||this.testGroup().controls.details.removeAt(t)}return this.testGroup().controls.details.controls}changeScore(e,o){let t=this.testGroup().controls.details.controls[o].controls.score;e==="plus"?t.setValue(t.value+1):t.value>1&&t.setValue(t.value-1)}removeGroup(){this.onRemoveGroup.emit()}totalBalls(){return this.testGroup().value.details.reduce((e,o)=>e+o.count*o.score,0)}listenQuestionGroup(){this.testGroup().controls.questionGroupId.valueChanges.pipe(me(this.testGroup().controls.questionGroupId.value),pe(e=>!!e),le(e=>this.questionGroupService.detail(e)),B(e=>e.result),ue(e=>{this.loadDetails(e),this.group.set(e)}),Pe(this.destroyRef)).subscribe()}static \u0275fac=function(o){return new(o||n)(V(fe),V(be))};static \u0275cmp=c({type:n,selectors:[["test-group"]],inputs:{testGroup:[1,"testGroup"],index:[1,"index"]},outputs:{onRemoveGroup:"onRemoveGroup"},decls:20,vars:5,consts:[[1,"group",3,"formGroup"],[1,"controls"],[1,"control"],["for","questionGroupId"],["formControlName","questionGroupId","label","name","value","id","id","questionGroupId",3,"requestFunc"],[1,"simple-input-container","color-too"],[1,"simple-input-container","text-primary-600"],[1,"controls",3,"formGroup","flex-direction"],["label","Guruhni o'chirish","variant","outlined","severity","secondary"],[1,"controls",3,"formGroup"],[1,"flex","justify-between"],["id","count","placeholder","count","type","number","pInputText","","formControlName","count",3,"max"],["icon","pi pi-plus","severity","secondary",3,"onClick"],["pInputText","","placeholder","Vote","type","number","formControlName","score"],["icon","pi pi-minus","severity","secondary",3,"onClick"],["label","Guruhni o'chirish","variant","outlined","severity","secondary",3,"onClick"]],template:function(o,t){o&1&&(i(0,"form",0)(1,"div",1)(2,"div",2)(3,"label",3),p(4,"Savol guruhi"),r(),l(5,"entity-select",4),r(),i(6,"div",2)(7,"label"),p(8,"Mavjud tillar"),r(),i(9,"span",5),p(10),r()(),i(11,"div",2)(12,"label"),p(13,"Jami ball:"),r(),i(14,"span",6),p(15),r()()(),i(16,"div",1),A(17,We,17,10,"form",7,He),r(),he(19,ze,1,0,"p-button",8),r()),o&2&&(a("formGroup",t.testGroup()),s(5),a("requestFunc",t.questionGroupService.query),s(5),P(t.languages()),s(5),P(t.totalBalls()),s(2),j(t.testGroup().controls.details.controls),s(2),ye(t.index()?19:-1))},dependencies:[U,T,$,W,E,y,Se,x,C,z,X,q,J,K,L],styles:[".group[_ngcontent-%COMP%]{display:flex;width:100%;flex-wrap:wrap;padding:15px 12px;align-items:flex-start;gap:30px;min-height:350px;border-radius:8px;background:#f9f9f9}.group[_ngcontent-%COMP%]   .controls[_ngcontent-%COMP%]:nth-child(2){width:calc(60% - 15px)}.group[_ngcontent-%COMP%]   .controls[_ngcontent-%COMP%]:nth-child(1){width:calc(40% - 15px)}.group[_ngcontent-%COMP%]   .simple-input-container[_ngcontent-%COMP%]{font-family:inherit;font-feature-settings:inherit;font-size:1rem;background:var(--p-inputtext-background);padding-block:var(--p-inputtext-padding-y);padding-inline:var(--p-inputtext-padding-x);border:1px solid var(--p-inputtext-border-color);transition:background var(--p-inputtext-transition-duration),color var(--p-inputtext-transition-duration),border-color var(--p-inputtext-transition-duration),outline-color var(--p-inputtext-transition-duration),box-shadow var(--p-inputtext-transition-duration);appearance:none;border-radius:var(--p-inputtext-border-radius);outline-color:transparent;box-shadow:var(--p-inputtext-shadow);height:40px}.group[_ngcontent-%COMP%]   .color-too[_ngcontent-%COMP%]{color:var(--p-inputtext-color)}"]})};var Ue=(n,e)=>e.controls.questionGroupId.value;function Je(n,e){if(n&1){let o=k();i(0,"test-group",5),f("onRemoveGroup",function(){let m=S(o).$index,u=_();return w(u.removeGroup(m))}),r()}if(n&2){let o=e.$implicit,t=e.$index;a("testGroup",o)("index",t)}}var oe=class n extends I{testFormService=d(G);addGroup(){this.formGroup.controls.details.push(this.testFormService.newQuestionDetail())}removeGroup(e){this.formGroup.controls.details.removeAt(e)}static \u0275fac=(()=>{let e;return function(t){return(e||(e=b(n)))(t||n)}})();static \u0275cmp=c({type:n,selectors:[["test-groups"]],features:[F],decls:7,vars:2,consts:[[1,"body",3,"formGroup"],[1,"form-title"],[1,"groups"],[3,"testGroup","index"],["label","Guruh qo\u2019shish","icon","pi pi-plus","variant","outlined",3,"onClick","disabled"],[3,"onRemoveGroup","testGroup","index"]],template:function(o,t){o&1&&(i(0,"form",0)(1,"h1",1),p(2,"Sinov guruhlari"),r(),i(3,"div",2),A(4,Je,1,2,"test-group",3,Ue),r(),i(6,"p-button",4),f("onClick",function(){return t.addGroup()}),r()()),o&2&&(a("formGroup",t.formGroup),s(4),j(t.formGroup.controls.details.controls),s(2),a("disabled",t.formGroup.controls.details.invalid))},dependencies:[x,T,y,C,te,q],encapsulation:2})};var re=class n extends ke{options=M.required();readonly=M();change(){this.onChange(this.itemValue())}static \u0275fac=(()=>{let e;return function(t){return(e||(e=b(n)))(t||n)}})();static \u0275cmp=c({type:n,selectors:[["enum-select"]],inputs:{options:[1,"options"],readonly:[1,"readonly"]},features:[D([{provide:Te,multi:!0,useExisting:de(()=>n)}]),F],decls:1,vars:5,consts:[["optionLabel","key","optionValue","value",3,"ngModelChange","ngModel","options","readonly"]],template:function(o,t){o&1&&(i(0,"p-select",0),Ge("ngModelChange",function(u){return xe(t.itemValue,u)||(t.itemValue=u),u}),f("ngModelChange",function(){return t.change()}),r()),o&2&&(h("width",100,"%"),Ce("ngModel",t.itemValue),a("options",t.options())("readonly",t.readonly()))},dependencies:[Ne,U,E,_e],styles:["[_nghost-%COMP%]{display:flex;width:100%}"]})};var ne=class n extends I{categoryService=d(se);layout=Y(ee);static \u0275fac=(()=>{let e;return function(t){return(e||(e=b(n)))(t||n)}})();static \u0275cmp=c({type:n,selectors:[["test-footer"]],features:[D([se]),F],decls:26,vars:6,consts:[[1,"footer",3,"formGroup"],[1,"controls"],[1,"control"],["for","price"],["id","price","formControlName","price","placeholder","120 000"],["for","reservedTime"],["id","reservedTime","placeholder","120","type","number","pInputText","","formControlName","reservedTime"],["for","viewType"],["formControlName","layout","id","viewType",3,"options"],["for","categoryId"],["formControlName","categoryId","label","name","value","id","id","categoryId",3,"requestFunc"],["formControlName","isRandomly",3,"binary"]],template:function(o,t){o&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"label",3),p(4,"Sinov narxi"),r(),i(5,"p-inputgroup")(6,"p-inputgroup-addon"),p(7,"so'm"),r(),l(8,"p-inputNumber",4),r()(),i(9,"div",2)(10,"label",5),p(11,"Sinov uchun ajratilgan vaqt"),r(),l(12,"input",6),r(),i(13,"div",2)(14,"label",7),p(15,"Test ko`rinishi"),r(),l(16,"enum-select",8),r(),i(17,"div",2)(18,"label",9),p(19,"Kategoriya"),r(),l(20,"entity-select",10),r()(),i(21,"div",1)(22,"div",2)(23,"label",3),p(24,"Random"),r(),l(25,"p-checkbox",11),r()()()),o&2&&(a("formGroup",t.formGroup),s(),h("flex-direction","row"),s(15),a("options",t.layout),s(4),a("requestFunc",t.categoryService.query),s(5),a("binary",!0))},dependencies:[x,$,W,E,y,C,z,J,re,X,K,L,Ie,qe,Ee],encapsulation:2})};var Oe=class n{constructor(e){this.messageService=e;O(()=>this.initEditMode(this.test()))}testFormService=d(G);router=d(De);route=d(Me);testService=d(je);test=Re(this.route.data.pipe(B(({test:e})=>e)));get formGroup(){return this.testFormService.formGroup}get rowData(){return this.formGroup.getRawValue()}save(){this.formGroup.disable(),this.test()?.id?this.update():this.create()}cancel(){this.router.navigate(["/dashboard/tests"])}initEditMode(e){e?.id&&this.testFormService.patchValue(e)}create(){this.testService.create(this.rowData).subscribe({next:()=>{this.cancel(),this.formGroup.enable()},error:()=>{this.messageService.add({severity:"error",summary:"Saqlab bo`lmadi"}),this.formGroup.enable()}})}update(){this.testService.update(this.rowData).subscribe({next:()=>{this.cancel(),this.formGroup.enable()},error:()=>{this.messageService.add({severity:"error",summary:"Saqlab bo`lmadi"}),this.formGroup.enable()}})}static \u0275fac=function(o){return new(o||n)(V(we))};static \u0275cmp=c({type:n,selectors:[["ng-component"]],features:[D([G])],decls:7,vars:2,consts:[[1,"test-form",3,"formGroup"],[1,"actions"],["label","Bekor qilish","variant","outlined","severity","secondary",3,"onClick"],["label","Saqlash",3,"onClick","disabled"]],template:function(o,t){o&1&&(i(0,"form",0),l(1,"test-header")(2,"test-groups")(3,"test-footer"),i(4,"div",1)(5,"p-button",2),f("onClick",function(){return t.cancel()}),r(),i(6,"p-button",3),f("onClick",function(){return t.save()}),r()()()),o&2&&(a("formGroup",t.formGroup),s(6),a("disabled",t.formGroup.invalid||t.formGroup.disabled))},dependencies:[x,T,y,C,Z,oe,q,ne],styles:[`.test-form{display:flex;flex-direction:column;gap:20px}.test-form .card,.test-form .actions,.test-form .body,.test-form .footer,.test-form .header{border-radius:16px;border:1px solid var(--Gray-200, #DCDCDC);background:var(--system-white, #FFF);padding:11px 24px}.test-form .header{gap:20px;flex-wrap:wrap}.test-form .header name-translates{width:100%}.test-form .header name-translates .control{width:25%}.test-form .footer{gap:20px}.test-form .footer .control{width:25%}.test-form .body{display:flex;flex-direction:column;gap:20px;padding-top:24px}.test-form .body .groups{display:flex;gap:40px;flex-wrap:wrap}.test-form .body .groups test-group{width:calc(50% - 20px)}.test-form .actions{display:flex;gap:20px}.test-form .actions p-button{width:50%}.test-form .actions p-button button{width:100%}
`],encapsulation:2})};export{Oe as TestFormComponent};
