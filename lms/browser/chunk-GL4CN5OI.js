import{a as G}from"./chunk-LXPRSSBN.js";import{$ as f,B as V,M as k,P as H,S as A,U as K,Y as m,ba as g,ca as R,da as p,f as $,g as E,j as P,l as M,m as S,q as L,qa as B,r as _,w as x}from"./chunk-63MFA3PC.js";import{a as d,b,d as F}from"./chunk-RJNTS35V.js";var z=class{static injector};var D=class{translations;constructor(o){this.translations=o}getTranslation(o){return S(this.translations.get(o)||{})}},Y=new f("");function N(t,o){return t&&(Object.prototype.hasOwnProperty.call(t,o)?t[o]:o.split(".").reduce((e,n)=>e?.[n],t))}function se(t,o,e){t=d({},t);let n=o.split("."),i=n.length-1;return n.reduce((r,s,a)=>(a===i?r[s]=e:r[s]=Array.isArray(r[s])?r[s].slice():d({},r[s]),r&&r[s]),t),t}function U(t){return t?Array.isArray(t)?t.length:w(t)?Object.keys(t).length:t?t.length:0:0}function re(t){return U(t)===0}function ae(t){return typeof t=="function"}function O(t){return typeof t=="string"}function w(t){return!!t&&typeof t=="object"&&!Array.isArray(t)}function oe(t){return t.replace(/(?:^\w|[A-Z]|\b\w)/g,(o,e)=>e==0?o.toLowerCase():o.toUpperCase()).replace(/\s+|_|-|\//g,"")}function I(t){return t==null}function J(t){return I(t)===!1}function ce(t){return t&&typeof t.scope=="string"}function le(t){return t&&w(t.loader)}function W(t){let o={};function e(n,i){if(n===null)o[i]=null;else if(w(n))for(let[r,s]of Object.entries(n))e(s,i?`${i}.${r}`:r);else o[i]=n}return e(t,""),o}function ue(t){let o={};for(let[e,n]of Object.entries(t)){let i=e.split("."),r=o;i.forEach((s,a)=>{a===i.length-1?r[s]=n:(r[s]??={},r=r[s])})}return o}var T=new f("",{providedIn:"root",factory:()=>y}),y={defaultLang:"en",reRenderOnLangChange:!1,prodMode:!1,failedRetries:2,fallbackLang:[],availableLangs:[],missingHandler:{logMissingKey:!0,useFallbackTranslation:!1,allowEmpty:!1},flatten:{aot:!1},interpolation:["{{","}}"],scopes:{keepCasing:!1}};function de(t={}){return b(d(d({},y),t),{missingHandler:d(d({},y.missingHandler),t.missingHandler),flatten:d(d({},y.flatten),t.flatten),scopes:d(d({},y.scopes),t.scopes)})}var Z=new f(""),he=(()=>{class t{config=R(T,{optional:!0})??y;get interpolationMatcher(){return fe(this.config)}transpile({value:e,params:n={},translation:i,key:r}){if(O(e)){let s,a=e;for(;(s=this.interpolationMatcher.exec(a))!==null;){let[l,c]=s;a=a.replace(l,()=>{let u=c.trim(),h=N(n,u);return J(h)?h:J(i[u])?this.transpile({params:n,translation:i,key:r,value:i[u]}):""})}return a}else n&&(w(e)?e=this.handleObject({value:e,params:n,translation:i,key:r}):Array.isArray(e)&&(e=this.handleArray({value:e,params:n,translation:i,key:r})));return e}handleObject({value:e,params:n={},translation:i,key:r}){let s=e;return Object.keys(n).forEach(a=>{let l=this.transpile({value:N(s,a),params:N(n,a),translation:i,key:r});s=se(s,a,l)}),s}handleArray(i){var r=i,{value:e}=r,n=F(r,["value"]);return e.map(s=>this.transpile(d({value:s},n)))}static \u0275fac=function(n){return new(n||t)};static \u0275prov=m({token:t,factory:t.\u0275fac})}return t})();function fe(t){let[o,e]=t.interpolation;return new RegExp(`${o}([^${o}${e}]*?)${e}`,"g")}var q=new f(""),ge=(()=>{class t{handle(e,n){if(n.missingHandler.logMissingKey&&!n.prodMode){let i=`Missing translation for '${e}'`;console.warn(`%c ${i}`,"font-size: 12px; color: red")}return e}static \u0275fac=function(n){return new(n||t)};static \u0275prov=m({token:t,factory:t.\u0275fac})}return t})(),Q=new f(""),pe=(()=>{class t{preSaveTranslation(e){return e}preSaveTranslationKey(e,n){return n}static \u0275fac=function(n){return new(n||t)};static \u0275prov=m({token:t,factory:t.\u0275fac})}return t})(),X=new f(""),ve=(()=>{class t{userConfig;constructor(e){this.userConfig=e}getNextLangs(){let e=this.userConfig.fallbackLang;if(!e)throw new Error("When using the default fallback, a fallback language must be provided in the config!");return Array.isArray(e)?e:[e]}static \u0275fac=function(n){return new(n||t)(g(T))};static \u0275prov=m({token:t,factory:t.\u0275fac})}return t})();function C(t){if(!t)return"";let o=t.split("/");return o.pop(),o.join("/")}function v(t){return t?t.split("/").pop():""}function Le(t,o){return Object.keys(t).reduce((e,n)=>(e[`${o}/${n}`]=t[n],e),{})}function me(t,o){return le(t)?Le(t.loader,o):void 0}function j(t){return{scope:C(t)||null,langName:v(t)}}function ee(t){let{path:o,inlineLoader:e,mainLoader:n,data:i}=t;if(e){let r=e[o];if(ae(r)===!1)throw`You're using an inline loader but didn't provide a loader for ${o}`;return e[o]().then(s=>s.default?s.default:s)}return n.getTranslation(o,i)}function ye({mainLoader:t,path:o,data:e,fallbackPath:n,inlineLoader:i}){return(n?[o,n]:[o]).map(s=>{let a=ee({path:s,mainLoader:t,inlineLoader:i,data:e});return M(a).pipe(L(l=>({translation:l,lang:s})))})}var Te;var ut=(()=>{class t{loader;parser;missingHandler;interceptor;fallbackStrategy;langChanges$;translations=new Map;cache=new Map;firstFallbackLang;defaultLang="";availableLangs=[];isResolvedMissingOnce=!1;lang;failedLangs=new Set;events=new $;events$=this.events.asObservable();config;destroyRef=R(B);constructor(e,n,i,r,s,a){this.loader=e,this.parser=n,this.missingHandler=i,this.interceptor=r,this.fallbackStrategy=a,this.loader||(this.loader=new D(this.translations)),Te=this,this.config=JSON.parse(JSON.stringify(s)),this.setAvailableLangs(this.config.availableLangs||[]),this.setFallbackLangForMissingTranslation(this.config),this.setDefaultLang(this.config.defaultLang),this.lang=new E(this.getDefaultLang()),this.langChanges$=this.lang.asObservable(),this.events$.subscribe(l=>{l.type==="translationLoadSuccess"&&l.wasFailure&&this.setActiveLang(l.payload.langName)}),this.destroyRef.onDestroy(()=>{this.lang.complete(),this.events.complete(),this.cache.clear()})}getDefaultLang(){return this.defaultLang}setDefaultLang(e){this.defaultLang=e}getActiveLang(){return this.lang.getValue()}setActiveLang(e){return this.parser.onLangChanged?.(e),this.lang.next(e),this.events.next({type:"langChanged",payload:j(e)}),this}setAvailableLangs(e){this.availableLangs=e}getAvailableLangs(){return this.availableLangs}load(e,n={}){let i=this.cache.get(e);if(i)return i;let r,s=this._isLangScoped(e),a;s&&(a=C(e));let l={path:e,mainLoader:this.loader,inlineLoader:n.inlineLoader,data:s?{scope:a}:void 0};if(this.useFallbackTranslation(e)){let u=s?`${a}/${this.firstFallbackLang}`:this.firstFallbackLang,h=ye(b(d({},l),{fallbackPath:u}));r=x(h)}else{let u=ee(l);r=M(u)}let c=r.pipe(k(this.config.failedRetries),K(u=>{if(Array.isArray(u)){u.forEach(h=>{this.handleSuccess(h.lang,h.translation),h.lang!==e&&this.cache.set(h.lang,S({}))});return}this.handleSuccess(e,u)}),V(u=>(this.config.prodMode||console.error(`Error while trying to load "${e}"`,u),this.handleFailure(e,n))),H(1),G(this.destroyRef));return this.cache.set(e,c),c}translate(e,n={},i=this.getActiveLang()){if(!e)return e;let{scope:r,resolveLang:s}=this.resolveLangAndScope(i);if(Array.isArray(e))return e.map(c=>this.translate(r?`${r}.${c}`:c,n,s));e=r?`${r}.${e}`:e;let a=this.getTranslation(s),l=a[e];return l?this.parser.transpile({value:l,params:n,translation:a,key:e}):this._handleMissingKey(e,l,n)}selectTranslate(e,n,i,r=!1){let s,a=(c,u)=>this.load(c,u).pipe(L(()=>r?this.translateObject(e,n,c):this.translate(e,n,c)));if(I(i))return this.langChanges$.pipe(A(c=>a(c)));if(i=Array.isArray(i)?i[0]:i,ce(i)){let c=i;i=c.scope,s=me(c,c.scope)}if(i=i,this.isLang(i)||this.isScopeWithLang(i))return a(i);let l=i;return this.langChanges$.pipe(A(c=>a(`${l}/${c}`,{inlineLoader:s})))}isScopeWithLang(e){return this.isLang(v(e))}translateObject(e,n={},i=this.getActiveLang()){if(O(e)||Array.isArray(e)){let{resolveLang:s,scope:a}=this.resolveLangAndScope(i);if(Array.isArray(e))return e.map(u=>this.translateObject(a?`${a}.${u}`:u,n,s));let l=this.getTranslation(s);e=a?`${a}.${e}`:e;let c=ue(this.getObjectByKey(l,e));return re(c)?this.translate(e,n,i):this.parser.transpile({value:c,params:n,translation:l,key:e})}let r=[];for(let[s,a]of this.getEntries(e))r.push(this.translateObject(s,a,i));return r}selectTranslateObject(e,n,i){if(O(e)||Array.isArray(e))return this.selectTranslate(e,n,i,!0);let[[r,s],...a]=this.getEntries(e);return this.selectTranslateObject(r,s,i).pipe(L(l=>{let c=[l];for(let[u,h]of a)c.push(this.translateObject(u,h,i));return c}))}getTranslation(e){if(e){if(this.isLang(e))return this.translations.get(e)||{};{let{scope:n,resolveLang:i}=this.resolveLangAndScope(e),r=this.translations.get(i)||{};return this.getObjectByKey(r,n)}}return this.translations}selectTranslation(e){let n=this.langChanges$;if(e){let i=v(e)!==e;this.isLang(e)||i?n=S(e):n=this.langChanges$.pipe(L(r=>`${e}/${r}`))}return n.pipe(A(i=>this.load(i).pipe(L(()=>this.getTranslation(i)))))}setTranslation(e,n=this.getActiveLang(),i={}){let s=d(d({},{merge:!0,emitChange:!0}),i),a=C(n),l=e;if(a){let ne=this.getMappedScope(a);l=W({[ne]:e})}let c=a?v(n):n,u=d(d({},s.merge&&this.getTranslation(c)),l),h=this.config.flatten.aot?u:W(u),te=this.interceptor.preSaveTranslation(h,c);this.translations.set(c,te),s.emitChange&&this.setActiveLang(this.getActiveLang())}setTranslationKey(e,n,i={}){let r=i.lang||this.getActiveLang(),s=this.interceptor.preSaveTranslationKey(e,n,r),a={[e]:s};this.setTranslation(a,r,b(d({},i),{merge:!0}))}setFallbackLangForMissingTranslation({fallbackLang:e}){let n=Array.isArray(e)?e[0]:e;e&&this.useFallbackTranslation(n)&&(this.firstFallbackLang=n)}_handleMissingKey(e,n,i){if(this.config.missingHandler.allowEmpty&&n==="")return"";if(!this.isResolvedMissingOnce&&this.useFallbackTranslation()){this.isResolvedMissingOnce=!0;let r=this.translate(e,i,this.firstFallbackLang);return this.isResolvedMissingOnce=!1,r}return this.missingHandler.handle(e,this.getMissingHandlerData(),i)}_isLangScoped(e){return this.getAvailableLangsIds().indexOf(e)===-1}isLang(e){return this.getAvailableLangsIds().indexOf(e)!==-1}_loadDependencies(e,n){let i=v(e);return this._isLangScoped(e)&&!this.isLoadedTranslation(i)?_([this.load(i),this.load(e,{inlineLoader:n})]):this.load(e,{inlineLoader:n})}_completeScopeWithLang(e){return this._isLangScoped(e)&&!this.isLang(v(e))?`${e}/${this.getActiveLang()}`:e}_setScopeAlias(e,n){this.config.scopeMapping||(this.config.scopeMapping={}),this.config.scopeMapping[e]=n}isLoadedTranslation(e){return U(this.getTranslation(e))}getAvailableLangsIds(){let e=this.getAvailableLangs()[0];return O(e)?this.getAvailableLangs():this.getAvailableLangs().map(n=>n.id)}getMissingHandlerData(){return b(d({},this.config),{activeLang:this.getActiveLang(),availableLangs:this.availableLangs,defaultLang:this.defaultLang})}useFallbackTranslation(e){return this.config.missingHandler.useFallbackTranslation&&e!==this.firstFallbackLang}handleSuccess(e,n){this.setTranslation(n,e,{emitChange:!1}),this.events.next({wasFailure:!!this.failedLangs.size,type:"translationLoadSuccess",payload:j(e)}),this.failedLangs.forEach(i=>this.cache.delete(i)),this.failedLangs.clear()}handleFailure(e,n){I(n.failedCounter)&&(n.failedCounter=0,n.fallbackLangs||(n.fallbackLangs=this.fallbackStrategy.getNextLangs(e)));let i=e.split("/"),s=n.fallbackLangs[n.failedCounter];if(this.failedLangs.add(e),this.cache.has(s))return this.handleSuccess(s,this.getTranslation(s)),P;let a=s===i[i.length-1];if(!s||a){let c="Unable to load translation and all the fallback languages";throw i.length>1&&(c+=", did you misspelled the scope name?"),new Error(c)}let l=s;return i.length>1&&(i[i.length-1]=s,l=i.join("/")),n.failedCounter++,this.events.next({type:"translationLoadFailure",payload:j(e)}),this.load(l,n)}getMappedScope(e){let{scopeMapping:n={},scopes:i={keepCasing:!1}}=this.config;return n[e]||(i.keepCasing?e:oe(e))}resolveLangAndScope(e){let n=e,i;if(this._isLangScoped(e)){let r=v(e),s=this.isLang(r);n=s?r:this.getActiveLang(),i=this.getMappedScope(s?C(e):e)}return{scope:i,resolveLang:n}}getObjectByKey(e,n){let i={},r=`${n}.`;for(let s in e)s.startsWith(r)&&(i[s.replace(r,"")]=e[s]);return i}getEntries(e){return e instanceof Map?e.entries():Object.entries(e)}static \u0275fac=function(n){return new(n||t)(g(Y,8),g(Z),g(q),g(Q),g(T),g(X))};static \u0275prov=m({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var dt=new f(""),ht=new f(""),ft=new f("");function gt(t){let o=[Ae(he),Ce(ge),we(pe),Oe(ve)];return t.config&&o.push(be(t.config)),t.loader&&o.push(Se(t.loader)),o}function be(t){return p([{provide:T,useValue:de(t)}])}function Se(t){return p([{provide:Y,useClass:t}])}function Ae(t){return p([{provide:Z,useClass:t,deps:[T]}])}function Oe(t){return p([{provide:X,useClass:t,deps:[T]}])}function Ce(t){return p([{provide:q,useClass:t}])}function we(t){return p([{provide:Q,useClass:t}])}var pt=new f("TRANSLOCO_TEST_LANGS - Available testing languages"),vt=new f("TRANSLOCO_TEST_OPTIONS - Testing options");export{z as a,ut as b,gt as c};
