import{a as G}from"./chunk-LX64QBDP.js";import{a as Ne,b as ke}from"./chunk-GL4CN5OI.js";import{a as xe,b as Fe}from"./chunk-PT2FAIS2.js";import{a as qe,b as $e}from"./chunk-AUEAYR74.js";import{a as V}from"./chunk-QZGE4ZPE.js";import{a as ve,b as _e}from"./chunk-A7WSSFSD.js";import{a as H}from"./chunk-X5MQVGBP.js";import"./chunk-G6JUXHBF.js";import"./chunk-UY2FQ6MC.js";import"./chunk-LXPRSSBN.js";import{d as A,e as Ee,f as Te}from"./chunk-MIRYO6HP.js";import{i as ye,j as Ie,k as Se}from"./chunk-O2BGHH3Y.js";import"./chunk-EBH5WAC4.js";import{a as R,b as Ce}from"./chunk-2WU6MFP7.js";import"./chunk-OBQI4AT4.js";import"./chunk-AAYNF2LC.js";import"./chunk-O2RJDLPA.js";import"./chunk-E5I4EK5F.js";import"./chunk-LHBSFRJO.js";import"./chunk-WMQMVF6V.js";import{a as w,b as fe}from"./chunk-R72LOZJZ.js";import{e as he,h as be}from"./chunk-OLD4CQRK.js";import{A as ge,b as le,c as f,f as E,g as T,j as se,k as q,m as me,n as $,o as ue,p as de,q as N,t as k,u as pe,v as Q,z as M}from"./chunk-GWOLZENT.js";import"./chunk-UM7JX4F5.js";import{U as ce}from"./chunk-ZKNP4OTC.js";import{$b as te,Bb as L,Cb as z,Db as Y,Eb as o,Fb as n,Gb as m,Hb as F,Ib as I,Kb as W,Nb as c,Ob as g,Wb as u,Ya as a,Yb as S,ac as ie,bc as ne,ca as d,cc as oe,hb as x,ja as j,ka as U,nb as h,tc as re,ub as s,wa as O,ya as C,zb as b,zc as ae}from"./chunk-63MFA3PC.js";import{a as Z,b as ee,h as D}from"./chunk-RJNTS35V.js";function J(r="Are you sure that you want to proceed?"){return(e,t,i)=>{let l=i.value;return i.value=function(...p){let _=Ne.injector;if(!_){console.error("Injector is not initialized.");return}let P=_.get(ce),y=_.get(ke);P.confirm({target:p[0],message:y.translate(r),header:y.translate("Confirmation"),rejectLabel:y.translate("no"),acceptLabel:y.translate("yes"),icon:"pi pi-exclamation-triangle",acceptIcon:"none",rejectIcon:"none",rejectButtonStyleClass:"p-button-text",accept:()=>{let X=l.apply(this,p);return console.log(`-- ${String(t)}() returned: `,X),X},reject:()=>{}})},i}}function Re(r,e){if(r&1){let t=W();m(0,"p-checkbox",23),o(1,"p-button",24),c("onClick",function(){j(t);let l=g(),p=l.$implicit,_=l.$index,P=g(2);return U(P.removeVariant(_,p.controls.id.value))}),n()}if(r&2){let t=g().$implicit;s("binary",!0)("formControl",t.controls.isRight)}}function Ae(r,e){if(r&1&&(F(0,19)(1,18)(2,19),o(3,"div",14),h(4,Re,2,2),m(5,"p-editor",21),n(),I()()()),r&2){let t=e.$implicit,i=g().$index;s("formGroup",t),a(2),s("formGroup",t.controls.contents.controls[i]),a(2),b(i===0?4:-1)}}function Ve(r,e){if(r&1&&(o(0,"div",10),F(1,18)(2,19),o(3,"div",20)(4,"label"),u(5),n(),m(6,"p-editor",21),n(),I()(),F(7,22),z(8,Ae,6,3,"ng-container",19,L),I(),n()),r&2){let t=e.$implicit,i=g();a(2),s("formGroup",t),a(3),S("Savol (",t.controls.languageName.value,") *"),a(3),Y(i.variants.controls)}}function Ge(r,e){if(r&1){let t=W();o(0,"p-paginator",25),c("onPageChange",function(l){j(t);let p=g();return U(p.onPageChange(l))}),n()}if(r&2){let t=g();s("first",t.first)("rows",t.rows)("totalRecords",e)}}var v=class v{languages=O.required();testId=O.required();languageService=d(V);$fb=d(k);$data=d(G);$question=d($e);$cdr=d(re);question=C(void 0);questionsCount=C(0);loadingImportQuestion=C(!1);languageForUpload;uploadFile;first=0;rows=1;form=this.$fb.group({contents:this.$fb.array([]),variants:this.$fb.array([]),questionType:1,id:null});constructor(){ae(()=>{console.log(this.languages()),this.languages().map(e=>{this.contents.push(this.$fb.group({id:this.$fb.control(null),languageId:e.id,content:"",languageName:e.name}))})})}get contents(){return this.form.controls.contents}get variants(){return this.form.controls.variants}ngOnInit(){this.getQuestionByPageIndex(0)}getQuestionByPageIndex(e){this.$data.getAllQuestions(this.testId(),e).subscribe(t=>{console.log(t),t&&(this.resetForm(),this.questionsCount.set(t.total),this.question.set(t.items[0]),this.question().variants.forEach(i=>{this.addAnswer()}),this.form.patchValue(this.question()),console.log(this.form.getRawValue()))})}addAnswer(){this.form.controls.variants.push(this.$fb.group({contents:this.$fb.array(this.languages().map(e=>this.$fb.group({id:this.$fb.control(null),languageId:e.id,content:""}))),isRight:this.$fb.control(!1),id:this.$fb.control(null)}))}submit(){if(console.log(this.form.getRawValue()),this.question()){this.$data.updateQuestion([this.form.getRawValue()]).subscribe();return}this.createQuestion([this.form.getRawValue()]).subscribe(e=>{e&&this.getQuestionByPageIndex(this.first)})}createQuestion(e){return this.$data.createQuestion(this.testId(),e)}removeVariant(e,t){if(t){this.deleteVariant(t,e);return}this.variants.removeAt(e)}deleteVariant(e,t){this.$data.deleteVariantById(e).subscribe(i=>{i&&(this.variants.removeAt(t),this.$cdr.markForCheck())})}addQuestion(){this.questionsCount.set(this.questionsCount()+1),this.first=this.questionsCount()-1,this.question.set(void 0),this.resetForm()}delete(){this.$data.deleteQuestionById(this.question().id).subscribe(e=>{e&&this.getQuestionByPageIndex(this.first)})}changeFile(e,t){console.log(e,t),this.uploadFile=e.target.files[0],console.log(this.uploadFile)}upload(){this.loadingImportQuestion.set(!0),this.$question.importQuestion(this.uploadFile).subscribe(e=>{this.loadingImportQuestion.set(!1);let t=e.result.map(i=>({contents:[{languageId:this.languageForUpload,content:i.content}],variants:i.variants.map(l=>({contents:[{languageId:this.languageForUpload,content:l.content}],isRight:l.isRight}))}));this.createQuestion(t).subscribe(i=>{i&&(this.languageForUpload=void 0,this.uploadFile=void 0,this.getQuestionByPageIndex(this.first))}),console.log(e)})}resetForm(){this.form.reset(),this.form.controls.variants.clear()}onPageChange(e){this.first=e.first,this.getQuestionByPageIndex(e.page)}static \u0275fac=function(t){return new(t||v)};static \u0275cmp=x({type:v,selectors:[["app-questions"]],inputs:{languages:[1,"languages"],testId:[1,"testId"]},decls:24,vars:9,consts:[[1,"mt-6","bg-white","p-6","rounded-xl"],[1,"text-lg","font-semibold"],[1,"flex","gap-4","mt-4"],[1,"w-[200px]"],["label","name","value","id","id","languagesId",3,"ngModelChange","requestFunc","ngModel","placeholder"],[1,"pi","pi-upload"],["pInputText","","type","file","accept","application/docx, application/vnd.openxmlformats-officedocument.wordprocessingml.document",3,"change"],["icon","pi pi-upload","variant","outlined","label","Yuklash",3,"onClick","disabled","loading"],[1,"mt-6","bg-white","p-6","rounded-xl",3,"formGroup"],[1,"flex","gap-4","mt-4","overflow-auto"],[1,"flex","flex-col","gap-2","min-w-[500px]","w-full"],[1,"flex","justify-between","items-center","mt-4"],["icon","pi pi-plus","variant","outlined","severity","secondary","label","Javob qo'shish",3,"onClick"],[3,"first","rows","totalRecords"],[1,"flex","gap-2"],["icon","pi pi-trash","severity","danger",3,"onClick"],["icon","pi pi-save",3,"onClick","label"],["icon","pi pi-plus","variant","outlined","label","Yangi",3,"onClick","disabled"],["formArrayName","contents"],[3,"formGroup"],[1,"flex","flex-col","gap-2","mb-4"],["formControlName","content"],["formArrayName","variants"],["inputId","ingredient1",3,"binary","formControl"],["icon","pi pi-trash","variant","outlined","severity","danger",3,"onClick"],[3,"onPageChange","first","rows","totalRecords"]],template:function(t,i){if(t&1&&(o(0,"div",0)(1,"p",1),u(2,"Fayldan yuklash"),n(),o(3,"div",2)(4,"div",3)(5,"entity-select",4),ne("ngModelChange",function(p){return ie(i.languageForUpload,p)||(i.languageForUpload=p),p}),n()(),o(6,"p-inputgroup")(7,"p-inputgroup-addon"),m(8,"i",5),n(),o(9,"input",6),c("change",function(p){return i.changeFile(p,i.languageForUpload)}),n()(),o(10,"p-button",7),c("onClick",function(){return i.upload()}),n()()(),o(11,"form",8)(12,"p",1),u(13,"Test savollari"),n(),o(14,"div",9),z(15,Ve,10,2,"div",10,L),n(),o(17,"div",11)(18,"p-button",12),c("onClick",function(){return i.addAnswer()}),n(),h(19,Ge,1,3,"p-paginator",13),o(20,"div",14)(21,"p-button",15),c("onClick",function(){return i.delete()}),n(),o(22,"p-button",16),c("onClick",function(){return i.submit()}),n(),o(23,"p-button",17),c("onClick",function(){return i.addQuestion()}),n()()()()),t&2){let l;a(5),s("requestFunc",i.languageService.query),te("ngModel",i.languageForUpload),s("placeholder","Til"),a(5),s("disabled",!(i.languageForUpload&&i.uploadFile))("loading",i.loadingImportQuestion()),a(),s("formGroup",i.form),a(4),Y(i.contents.controls),a(4),b((l=i.questionsCount())?19:-1,l),a(3),s("label",i.question()?"Saqlash":"Yaratish"),a(),s("disabled",!i.question())}},dependencies:[M,w,xe,Q,q,E,T,me,$,N,de,R,Ie,Se,A,pe,se,qe],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0})};D([J()],v.prototype,"deleteVariant",1),D([J()],v.prototype,"delete",1);var B=v;function Be(r,e){r&1&&m(0,"p-button",3)}function Pe(r,e){if(r&1&&m(0,"app-questions",23),r&2){let t=g(2);s("languages",e.languages)("testId",t.id)}}function De(r,e){if(r&1&&h(0,Pe,1,2,"app-questions",23),r&2){let t,i=g();b((t=i.test())?0:-1,t)}}var K=class r{categoryService=d(H);languageService=d(V);$fb=d(k);$data=d(G);$router=d(be);id=d(he).snapshot.params.id;test=C(void 0);get isEdit(){return this.id}form=this.$fb.group({name:this.$fb.group({uz:["",f.required],ru:["",f.required]}),description:this.$fb.group({uz:["",f.required],ru:["",f.required]}),categoryId:this.$fb.control(null,f.required),price:this.$fb.control(null,f.required),layout:1,isRandomly:[!0,f.required],reservedTime:this.$fb.control(null,f.required),languagesId:this.$fb.control(null,f.required)});ngOnInit(){this.isEdit&&this.$data.getById(this.id).subscribe(e=>{e.result&&(this.test.set(e.result),this.form.patchValue(ee(Z({},e.result),{categoryId:e.result.category.id,languagesId:e.result.languages.map(t=>t.id)})))})}submit(){let e=this.form.getRawValue();this.id&&(e.id=this.id),this.$data.submit(e,!!this.id).subscribe(t=>{t.result&&(this.isEdit||this.$router.navigate(["/dashboard/tests/edit",t.result]))})}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=x({type:r,selectors:[["app-add-edit-test"]],features:[oe([H])],decls:49,vars:7,consts:[[1,"max-w-[1200px]","m-auto"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold"],["icon","pi pi-send","label","Yuborish"],[1,"mt-6","bg-white","p-6","rounded-xl"],[1,"text-lg","font-semibold"],[1,"grid","grid-cols-2","gap-4","mt-4",3,"formGroup"],["formGroupName","name",1,"flex","flex-col","gap-2"],["for","link"],["id","link","type","text","pInputText","","formControlName","uz"],["id","link","type","text","pInputText","","formControlName","ru"],["formGroupName","description",1,"flex","flex-col","gap-2"],[1,"flex","flex-col","gap-2"],["label","name","value","id","id","languagesId","formControlName","languagesId",3,"requestFunc"],["formControlName","categoryId","id","categoryId","label","name","value","id",3,"requestFunc"],["inputId","integeronly","formControlName","price"],["inputId","integeronly","formControlName","reservedTime"],[1,"flex","items-center"],["inputId","ingredient1","formControlName","isRandomly",3,"binary"],["for","ingredient1",1,"ml-2"],[1,"flex","justify-end","gap-2","mt-4"],["severity","secondary","label","Bekor qilish"],["label","Saqlash",3,"click"],[3,"languages","testId"]],template:function(t,i){t&1&&(o(0,"div",0)(1,"div",1)(2,"h1",2),u(3),n(),h(4,Be,1,0,"p-button",3),n(),o(5,"div",4)(6,"p",5),u(7,"Test ma'lumotlari"),n(),o(8,"form",6)(9,"div",7)(10,"label",8),u(11,"Test nomi (Uz) *"),n(),m(12,"textarea",9),n(),o(13,"div",7)(14,"label",8),u(15,"Test nomie (Ru) *"),n(),m(16,"textarea",10),n(),o(17,"div",11)(18,"label",8),u(19,"Test ta'rifi (Uz) *"),n(),m(20,"textarea",9),n(),o(21,"div",11)(22,"label",8),u(23,"Test ta'rifi (Ru) *"),n(),m(24,"textarea",10),n(),o(25,"div",12)(26,"label",8),u(27,"Tillar *"),n(),m(28,"entity-multi-select",13),n(),o(29,"div",12)(30,"label",8),u(31,"Kategoriya *"),n(),m(32,"entity-select",14),n(),o(33,"div",12)(34,"label",8),u(35,"Narx *"),n(),m(36,"p-inputnumber",15),n(),o(37,"div",12)(38,"label",8),u(39,"Ajratilgan vaqt (soniyalarda) *"),n(),m(40,"p-inputnumber",16),n(),o(41,"div",17),m(42,"p-checkbox",18),o(43,"label",19),u(44," Savollar random chiqsinmi "),n()()(),o(45,"div",20),m(46,"p-button",21),o(47,"p-button",22),c("click",function(){return i.submit()}),n()()(),h(48,De,1,1),n()),t&2&&(a(3),S(" ",i.isEdit?"Testni tahrirlash":"Yangi test yaratish"," "),a(),b(i.isEdit?4:-1),a(4),s("formGroup",i.form),a(20),s("requestFunc",i.languageService.query),a(4),s("requestFunc",i.categoryService.query),a(10),s("binary",!0),a(6),b(i.isEdit?48:-1))},dependencies:[ge,M,fe,w,ye,_e,ve,Ee,Ce,R,Fe,A,Te,Q,q,le,E,T,$,N,ue,B],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0})};export{K as default};
